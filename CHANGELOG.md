# Nano-Runtime 0.0.1  
Первая прототипная версия виртуальной машины Nano-Lang

---

## 1. Общая информация

**Nano-Runtime 0.0.1** — это первая рабочая версия виртуальной машины для будущего языка Nano-Lang.  
Версия выполняет простые программы, поддерживает функции, стеки, локальные переменные и базовые арифметические операции.

---

## 2. Реализованные возможности

### 2.1. Модель функций
- Объявление и хранение функций (`Function`).
- Каждая функция имеет:
  - `Name`
  - `VirtualName` (FNV-хеш имени)
  - список инструкций (`List<OpCode>`).

### 2.2. ExecutionPlan
- Хранит функции в виде словаря `Dictionary<string, Function>`.
- Проверяет корректность вызовов.
- Определяет точку входа `Main`.

### 2.3. Регистры (GlobalRegister)
Реализованы базовые регистры:
- `Accumulator`
- `InstructionPointer`
- `RunnedFunction`
- `CallBreakedPointer`

### 2.4. Стек вычислений
- Один стек целых чисел `GlobalStack.IntStack`.
- Используется для передачи данных между функциями.

### 2.5. Локальные переменные
`FunctionScope` обеспечивает:
- объявление переменных,
- проверку существования,
- хранение значений.

### 2.6. Система опкодов
Реализованы обработчики:
- `Def`
- `Loadi`
- `Puti`
- `Popi`
- `Add`
- `Call`
- `Ret`

### 2.7. Системные вызовы
Встроенная функция:
— выводит верхний элемент стека в консоль.

### 2.8. Обработка ошибок
- Все ошибки проходят через `FailedExectionPlan`.
- Поддерживаются коды ошибок (`FallbackCode`).
- Форматированные сообщения об ошибках.

---

# 3. Выявленные проблемы и баги

## 3.1. Некорректная реализация вызовов функций
Использование единственного глобального `CallBreakedPointer` приводит к неправильной работе вложенных вызовов.

**Следствия:**
- невозможность рекурсии,
- неверные возвраты из функций,
- повреждение состояния VM.
